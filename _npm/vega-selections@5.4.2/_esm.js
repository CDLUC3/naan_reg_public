/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/vega-selections@5.4.2/build/vega-selection.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{bisector as e,union as t,intersection as n}from"../d3-array@3.2.4/_esm.js";import{field as r,extend as i,array as u,toNumber as f,error as l,peek as s,hasOwnProperty as a,isDate as o,isArray as c,inrange as v}from"../vega-util@1.17.2/_esm.js";import{Literal as d}from"../vega-expression@5.1.1/_esm.js";const g=Symbol("vega_selection_getter");function p(e){return e.getter&&e.getter[g]||(e.getter=r(e.field),e.getter[g]=!0),e.getter}const h="intersect",m="union",_="_vgsid_",y=r(_),x="E",R="R",E="R-E",O="R-LE",$="R-RE",b="index:unit";function j(e,t){for(var n,r,i=t.fields,u=t.values,l=i.length,s=0;s<l;++s)if(n=p(r=i[s])(e),o(n)&&(n=f(n)),o(u[s])&&(u[s]=f(u[s])),c(u[s])&&o(u[s][0])&&(u[s]=u[s].map(f)),r.type===x){if(c(u[s])?u[s].indexOf(n)<0:n!==u[s])return!1}else if(r.type===R){if(!v(n,u[s]))return!1}else if(r.type===$){if(!v(n,u[s],!0,!1))return!1}else if(r.type===E){if(!v(n,u[s],!1,!1))return!1}else if(r.type===O&&!v(n,u[s],!1,!0))return!1;return!0}function k(e,t,n){for(var r,i,u,f,l,s=this.context.data[e],a=s?s.values.value:[],o=s?s[b]&&s[b].value:void 0,c=n===h,v=a.length,d=0;d<v;++d)if(r=a[d],o&&c){if(-1===(u=(i=i||{})[f=r.unit]||0))continue;if(l=j(t,r),i[f]=l?-1:++u,l&&1===o.size)return!0;if(!l&&u===o.get(f).count)return!1}else if(c^(l=j(t,r)))return l;return v&&c}const z=e(y),D=z.left,A=z.right;function F(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],u=r?r[b]&&r[b].value:void 0,f=n===h,l=y(t),s=D(i,l);if(s===i.length)return!1;if(y(i[s])!==l)return!1;if(u&&f){if(1===u.size)return!0;if(A(i,l)-s<u.size)return!1}return!0}function L(e,t){return e.map((e=>i(t.fields?{values:t.fields.map((t=>p(t)(e.datum)))}:{[_]:y(e.datum)},t)))}function M(e,t,n,r){for(var i,f,l,s,a,o,c,v,d,g,p,h,x=this.context.data[e],R=x?x.values.value:[],E={},O={},$={},b=R.length,j=0;j<b;++j)if(s=(i=R[j]).unit,f=i.fields,l=i.values,f&&l){for(p=0,h=f.length;p<h;++p)a=f[p],v=(c=E[a.field]||(E[a.field]={}))[s]||(c[s]=[]),$[a.field]=d=a.type.charAt(0),g=P[`${d}_union`],c[s]=g(v,u(l[p]));n&&(v=O[s]||(O[s]=[])).push(u(l).reduce(((e,t,n)=>(e[f[n].field]=t,e)),{}))}else a=_,o=y(i),(v=(c=E[a]||(E[a]={}))[s]||(c[s]=[])).push(o),n&&(v=O[s]||(O[s]=[])).push({[_]:o});if(t=t||m,E[_]?E[_]=P[`${_}_${t}`](...Object.values(E[_])):Object.keys(E).forEach((e=>{E[e]=Object.keys(E[e]).map((t=>E[e][t])).reduce(((n,r)=>void 0===n?r:P[`${$[e]}_${t}`](n,r)))})),R=Object.keys(O),n&&R.length){E[r?"vlPoint":"vlMulti"]=t===m?{or:R.reduce(((e,t)=>(e.push(...O[t]),e)),[])}:{and:R.map((e=>({or:O[e]})))}}return E}var P={[`${_}_union`]:t,[`${_}_intersect`]:n,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function S(e,t,n,r){t[0].type!==d&&l("First argument to selection functions must be a string literal.");const i=t[0].value,u="unit",f="@"+u,o=":"+i;(t.length>=2&&s(t).value)!==h||a(r,f)||(r[f]=n.getData(i).indataRef(n,u)),a(r,o)||(r[o]=n.getData(i).tuplesRef())}export{F as selectionIdTest,M as selectionResolve,k as selectionTest,L as selectionTuples,S as selectionVisitor};export default null;
