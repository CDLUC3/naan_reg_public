/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/vega-parser@6.4.0/build/vega-parser.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{stringValue as e,error as t,peek as n,isString as i,array as a,hasOwnProperty as l,isObject as o,extend as s,isArray as r,mergeConfig as u,splitAccessPath as c}from"../vega-util@1.17.2/_esm.js";import{parseExpression as d}from"../vega-functions@5.15.0/_esm.js";import{parseSelector as f}from"../vega-event-selector@3.0.1/_esm.js";import{isValidScaleType as p,isDiscrete as g,isQuantile as m,isContinuous as h,isDiscretizing as y}from"../vega-scale@7.4.1/_esm.js";import{definition as b}from"../vega-dataflow@5.7.6/_esm.js";function x(e){return o(e)?e:{type:e||"pad"}}const k=e=>+e||0,v=e=>({top:e,bottom:e,left:e,right:e});function $(e){return o(e)?e.signal?e:{top:k(e.top),bottom:k(e.bottom),left:k(e.left),right:k(e.right)}:v(k(e))}const S=e=>o(e)&&!r(e)?s({},e):{value:e};function R(e,t,n,i){if(null!=n){return o(n)&&!r(n)||r(n)&&n.length&&o(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1}return 0}function O(e,t,n){for(const n in t)R(e,n,t[n]);for(const t in n)R(e,t,n[t],"update")}function z(e,t,n){for(const i in t)n&&l(n,i)||(e[i]=s(e[i]||{},t[i]));return e}function w(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const W="mark",j="frame",_="scope",C="axis",D="axis-domain",E="axis-grid",F="axis-label",L="axis-tick",P="axis-title",T="legend",B="legend-band",U="legend-entry",A="legend-gradient",H="legend-label",M="legend-symbol",V="legend-title",q="title",I="title-text",X="title-subtitle";function Y(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const N=t=>i(t)?e(t):t.signal?`(${t.signal})`:Q(t);function G(t){if(null!=t.gradient)return function(t){const i=[t.start,t.stop,t.count].map((t=>null==t?null:e(t)));for(;i.length&&null==n(i);)i.pop();return i.unshift(N(t.gradient)),`gradient(${i.join(",")})`}(t);let i=t.signal?`(${t.signal})`:t.color?function(e){return e.c?J("hcl",e.h,e.c,e.l):e.h||e.s?J("hsl",e.h,e.s,e.l):e.l||e.a?J("lab",e.l,e.a,e.b):e.r||e.g||e.b?J("rgb",e.r,e.g,e.b):null}(t.color):null!=t.field?Q(t.field):void 0!==t.value?e(t.value):void 0;return null!=t.scale&&(i=function(e,t){const n=N(e.scale);null!=e.range?t=`lerp(_range(${n}), ${+e.range})`:(void 0!==t&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(1==+e.band?"":"*"+K(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),null==t&&(t="0"));return t}(t,i)),void 0===i&&(i=null),null!=t.exponent&&(i=`pow(${i},${K(t.exponent)})`),null!=t.mult&&(i+=`*${K(t.mult)}`),null!=t.offset&&(i+=`+${K(t.offset)}`),t.round&&(i=`round(${i})`),i}const J=(e,t,n,i)=>`(${e}(${[t,n,i].map(G).join(",")})+'')`;function K(e){return o(e)?"("+G(e)+")":e}function Q(e){return Z(o(e)?e:{datum:e})}function Z(n){let a,l,o;if(n.signal)a="datum",o=n.signal;else if(n.group||n.parent){for(l=Math.max(1,n.level||1),a="item";l-- >0;)a+=".mark.group";n.parent?(o=n.parent,a+=".datum"):o=n.group}else n.datum?(a="datum",o=n.datum):t("Invalid field reference: "+e(n));return n.signal||(o=i(o)?c(o).map(e).join("]["):Z(o)),a+"["+o+"]"}function ee(e,t,n,i,l,o){const r={};(o=o||{}).encoders={$encode:r},e=function(e,t,n,i,l){const o={},r={};let u,c,d,f;for(c in c="lineBreak","text"!==t||null==l[c]||w(c,e)||Y(o,c,l[c]),("legend"==n||String(n).startsWith("axis"))&&(n=null),f=n===j?l.group:n===W?s({},l.mark,l[t]):null,f)d=w(c,e)||("fill"===c||"stroke"===c)&&(w("fill",e)||w("stroke",e)),d||Y(o,c,f[c]);for(c in a(i).forEach((t=>{const n=l.style&&l.style[t];for(const t in n)w(t,e)||Y(o,t,n[t])})),e=s({},e),o)f=o[c],f.signal?(u=u||{})[c]=f:r[c]=f;return e.enter=s(r,e.enter),u&&(e.update=s(u,e.update)),e}(e,t,n,i,l.config);for(const n in e)r[n]=te(e[n],t,o,l);return o}function te(e,t,i,a){const l={},o={};for(const t in e)null!=e[t]&&(l[t]=ne((s=e[t],r(s)?function(e){let t="";return e.forEach((e=>{const n=G(e);t+=e.test?`(${e.test})?${n}:`:n})),":"===n(t)&&(t+="null"),t}(s):G(s)),a,i,o));var s;return{$expr:{marktype:t,channels:l},$fields:Object.keys(o),$output:Object.keys(e)}}function ne(e,t,n,i){const a=d(e,t);return a.$fields.forEach((e=>i[e]=1)),s(n,a.$params),a.$expr}const ie="outer",ae=["value","update","init","react","bind"];function le(n,i){t(n+' for "outer" push: '+e(i))}function oe(e,t){const n=e.name;if(e.push===ie)t.signals[n]||le("No prior signal definition",n),ae.forEach((t=>{void 0!==e[t]&&le("Invalid property ",t)}));else{const i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function se(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function re(e,t,n,i){return new se(e,t,n,i)}function ue(e,t){return re("operator",e,t)}function ce(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function de(e,t){return t?{$field:e,$name:t}:{$field:e}}const fe=de("key");function pe(e,t){return{$compare:e,$order:t}}const ge="descending";function me(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const he="scope",ye="view";function be(e){return e&&e.signal}function xe(e){if(be(e))return!0;if(o(e))for(const t in e)if(xe(e[t]))return!0;return!1}function ke(e,t){return null!=e?e:t}function ve(e){return e&&e.signal||e}const $e="timer";function Se(n,i){return(n.merge?Re:n.stream?Oe:n.type?ze:t("Invalid stream specification: "+e(n)))(n,i)}function Re(e,t){const n=we({merge:e.merge.map((e=>Se(e,t)))},e,t);return t.addStream(n).id}function Oe(e,t){const n=we({stream:Se(e.stream,t)},e,t);return t.addStream(n).id}function ze(e,t){let n;var i;e.type===$e?(n=t.event($e,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((i=e.source)===he?ye:i||ye,e.type);const a=we({stream:n},e,t);return 1===Object.keys(a).length?n:t.addStream(a).id}function we(n,i,a){let l=i.between;return l&&(2!==l.length&&t('Stream "between" parameter must have 2 entries: '+e(i)),n.between=[Se(l[0],a),Se(l[1],a)]),l=i.filter?[].concat(i.filter):[],(i.marktype||i.markname||i.markrole)&&l.push(function(e,t,n){const i="event.item";return i+(e&&"*"!==e?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}(i.marktype,i.markname,i.markrole)),i.source===he&&l.push("inScope(event.item)"),l.length&&(n.filter=d("("+l.join(")&&(")+")",a).$expr),null!=(l=i.throttle)&&(n.throttle=+l),null!=(l=i.debounce)&&(n.debounce=+l),i.consume&&(n.consume=!0),n}const We={code:"_.$value",ast:{type:"Identifier",value:"value"}};function je(n,l,o){const r=n.encode,u={target:o};let c=n.events,p=n.update,g=[];c||t("Signal update missing events specification."),i(c)&&(c=f(c,l.isSubscope()?he:ye)),c=a(c).filter((e=>e.signal||e.scale?(g.push(e),0):1)),g.length>1&&(g=[_e(g)]),c.length&&g.push(c.length>1?{merge:c}:c[0]),null!=r&&(p&&t("Signal encode and update are mutually exclusive."),p="encode(item(),"+e(r)+")"),u.update=i(p)?d(p,l):null!=p.expr?d(p.expr,l):null!=p.value?p.value:null!=p.signal?{$expr:We,$params:{$value:l.signalRef(p.signal)}}:t("Invalid signal update specification."),n.force&&(u.options={force:!0}),g.forEach((e=>l.addUpdate(s(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Se(e,t)}}(e,l),u))))}function _e(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}function Ce(e,n){const i=n.getSignal(e.name);let a=e.update;e.init&&(a?t("Signals can not include both init and update expressions."):(a=e.init,i.initonly=!0)),a&&(a=d(a,n),i.update=a.$expr,i.params=a.$params),e.on&&e.on.forEach((e=>je(e,n,i.id)))}const De=e=>(t,n,i)=>re(e,n,t||void 0,i),Ee=De("aggregate"),Fe=De("axisticks"),Le=De("bound"),Pe=De("collect"),Te=De("compare"),Be=De("datajoin"),Ue=De("encode"),Ae=De("expression"),He=De("facet"),Me=De("field"),Ve=De("key"),qe=De("legendentries"),Ie=De("load"),Xe=De("mark"),Ye=De("multiextent"),Ne=De("multivalues"),Ge=De("overlap"),Je=De("params"),Ke=De("prefacet"),Qe=De("projection"),Ze=De("proxy"),et=De("relay"),tt=De("render"),nt=De("scale"),it=De("sieve"),at=De("sortitems"),lt=De("viewlayout"),ot=De("values");let st=0;const rt={min:"min",max:"max",count:"sum"};function ut(e,t){const n=t.getScale(e.name).params;let i;for(i in n.domain=pt(e.domain,e,t),null!=e.range&&(n.range=vt(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=ct(e.type||e),null!=e.gamma&&(t.interpolateGamma=ct(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e,t){return e.signal?t.signalRef(e.signal):o(e)?{interval:ct(e.interval),step:ct(e.step)}:ct(e)}(e.nice,t)),null!=e.bins&&(n.bins=function(e,t){return e.signal||r(e)?dt(e,t):t.objectProperty(e)}(e.bins,t)),e)l(n,i)||"name"===i||(n[i]=ct(e[i],t))}function ct(n,i){return o(n)?n.signal?i.signalRef(n.signal):t("Unsupported object: "+e(n)):n}function dt(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>ct(e,t)))}function ft(n){t("Can not find data set: "+e(n))}function pt(e,n,i){if(e)return e.signal?i.signalRef(e.signal):(r(e)?gt:e.fields?ht:mt)(e,n,i);null==n.domainMin&&null==n.domainMax||t("No scale domain defined for domainMin/domainMax to override.")}function gt(e,t,n){return e.map((e=>ct(e,n)))}function mt(e,t,n){const i=n.getData(e.data);return i||ft(e.data),g(t.type)?i.valuesRef(n,e.field,bt(e.sort,!1)):m(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function ht(t,n,a){const l=t.data,o=t.fields.reduce(((t,n)=>(n=i(n)?{data:l,field:n}:r(n)||n.signal?function(t,n){const i="_:vega:_"+st++,a=Pe({});if(r(t))a.value={$ingest:t};else if(t.signal){const l="setdata("+e(i)+","+t.signal+")";a.params.input=n.signalRef(l)}return n.addDataPipeline(i,[a,it({})]),{data:i,field:"data"}}(n,a):n,t.push(n),t)),[]);return(g(n.type)?yt:m(n.type)?xt:kt)(t,a,o)}function yt(e,t,n){const i=bt(e.sort,!0);let a,l;const o=n.map((e=>{const n=t.getData(e.data);return n||ft(e.data),n.countsRef(t,e.field,i)})),s={groupby:fe,pulse:o};i&&(a=i.op||"count",l=i.field?me(a,i.field):"count",s.ops=[rt[a]],s.fields=[t.fieldRef(l)],s.as=[l]),a=t.add(Ee(s));const r=t.add(Pe({pulse:ce(a)}));return l=t.add(ot({field:fe,sort:t.sortRef(i),pulse:ce(r)})),ce(l)}function bt(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field&&e.op&&!rt[e.op]&&t("Multiple domain scales can not be sorted using "+e.op):t("No field provided for sort aggregate op: "+e.op):o(e)?e.field="key":e={field:"key"}),e}function xt(e,t,n){const i=n.map((e=>{const n=t.getData(e.data);return n||ft(e.data),n.domainRef(t,e.field)}));return ce(t.add(Ne({values:i})))}function kt(e,t,n){const i=n.map((e=>{const n=t.getData(e.data);return n||ft(e.data),n.extentRef(t,e.field)}));return ce(t.add(Ye({extents:i})))}function vt(n,a,o){const u=a.config.range;let c=n.range;if(c.signal)return a.signalRef(c.signal);if(i(c)){if(u&&l(u,c))return vt(n=s({},n,{range:u[c]}),a,o);"width"===c?c=[0,{signal:"width"}]:"height"===c?c=g(n.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t("Unrecognized scale range value: "+e(c))}else{if(c.scheme)return o.scheme=r(c.scheme)?dt(c.scheme,a):ct(c.scheme,a),c.extent&&(o.schemeExtent=dt(c.extent,a)),void(c.count&&(o.schemeCount=ct(c.count,a)));if(c.step)return void(o.rangeStep=ct(c.step,a));if(g(n.type)&&!r(c))return pt(c,n,a);r(c)||t("Unsupported range type: "+e(c))}return c.map((e=>(r(e)?dt:ct)(e,a)))}function $t(n,i,a){return r(n)?n.map((e=>$t(e,i,a))):o(n)?n.signal?a.signalRef(n.signal):"fit"===i?n:t("Unsupported parameter object: "+e(n)):n}const St="top",Rt="left",Ot="right",zt="bottom",wt="center",Wt="vertical",jt="start",_t="end",Ct="index",Dt="label",Et="offset",Ft="perc",Lt="perc2",Pt="value",Tt="guide-label",Bt="guide-title",Ut="group-title",At="group-subtitle",Ht="symbol",Mt="gradient",Vt="discrete",qt="size",It=[qt,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],Xt={name:1,style:1,interactive:1},Yt={value:0},Nt={value:1},Gt="group",Jt="rect",Kt="rule",Qt="symbol",Zt="text";function en(e){return e.type=Gt,e.interactive=e.interactive||!1,e}function tn(e,t){const n=(n,i)=>ke(e[n],ke(t[n],i));return n.isVertical=n=>Wt===ke(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>ke(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>ke(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>ke(e.columns,ke(t.columns,+n.isVertical(!0))),n}function nn(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function an(e,t,n){return`item.anchor === '${jt}' ? ${e} : item.anchor === '${_t}' ? ${t} : ${n}`}const ln=an(e(Rt),e(Ot),e(wt));function on(e,t){return t?e?o(e)?Object.assign({},e,{offset:on(e.offset,t)}):{value:e,offset:t}:t:e}function sn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=z(e.encode,t,Xt)):e.interactive=!1,e}function rn(e,t,n,i){const a=tn(e,n),l=a.isVertical(),o=a.gradientThickness(),r=a.gradientLength();let u,c,d,f,p;l?(c=[0,1],d=[0,0],f=o,p=r):(c=[0,0],d=[1,0],f=r,p=o);const g={enter:u={opacity:Yt,x:Yt,y:Yt,width:S(f),height:S(p)},update:s({},u,{opacity:Nt,fill:{gradient:t,start:c,stop:d}}),exit:{opacity:Yt}};return O(g,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),sn({type:Jt,role:A,encode:g},i)}function un(e,t,n,i,a){const l=tn(e,n),o=l.isVertical(),r=l.gradientThickness(),u=l.gradientLength();let c,d,f,p,g="";o?(c="y",f="y2",d="x",p="width",g="1-"):(c="x",f="x2",d="y",p="height");const m={opacity:Yt,fill:{scale:t,field:Pt}};m[c]={signal:g+"datum."+Ft,mult:u},m[d]=Yt,m[f]={signal:g+"datum."+Lt,mult:u},m[p]=S(r);const h={enter:m,update:s({},m,{opacity:Nt}),exit:{opacity:Yt}};return O(h,{stroke:l("gradientStrokeColor"),strokeWidth:l("gradientStrokeWidth")},{opacity:l("gradientOpacity")}),sn({type:Jt,role:B,key:Pt,from:a,encode:h},i)}const cn=`datum.${Ft}<=0?"${Rt}":datum.${Ft}>=1?"${Ot}":"${wt}"`,dn=`datum.${Ft}<=0?"${zt}":datum.${Ft}>=1?"${St}":"middle"`;function fn(e,t,n,i){const a=tn(e,t),l=a.isVertical(),o=S(a.gradientThickness()),s=a.gradientLength();let r,u,c,d,f=a("labelOverlap"),p="";const g={enter:r={opacity:Yt},update:u={opacity:Nt,text:{field:Dt}},exit:{opacity:Yt}};return O(g,{fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:ke(e.labelLimit,t.gradientLabelLimit)}),l?(r.align={value:"left"},r.baseline=u.baseline={signal:dn},c="y",d="x",p="1-"):(r.align=u.align={signal:cn},r.baseline={value:"top"},c="x",d="y"),r[c]=u[c]={signal:p+"datum."+Ft,mult:s},r[d]=u[d]=o,o.offset=ke(e.labelOffset,t.gradientLabelOffset)||0,f=f?{separation:a("labelSeparation"),method:f,order:"datum."+Ct}:void 0,sn({type:Zt,role:H,style:Tt,key:Pt,from:i,encode:g,overlap:f},n)}function pn(e,t,n,i,a){const l=tn(e,t),o=n.entries,s=!(!o||!o.interactive),r=o?o.name:void 0,u=l("clipHeight"),c=l("symbolOffset"),d={data:"value"},f=`(${a}) ? datum.${Et} : datum.${qt}`,p=u?S(u):{field:qt},g=`datum.${Ct}`,m=`max(1, ${a})`;let h,y,b,x,k;p.mult=.5,h={enter:y={opacity:Yt,x:{signal:f,mult:.5,offset:c},y:p},update:b={opacity:Nt,x:y.x,y:y.y},exit:{opacity:Yt}};let v=null,$=null;e.fill||(v=t.symbolBaseFillColor,$=t.symbolBaseStrokeColor),O(h,{fill:l("symbolFillColor",v),shape:l("symbolType"),size:l("symbolSize"),stroke:l("symbolStrokeColor",$),strokeDash:l("symbolDash"),strokeDashOffset:l("symbolDashOffset"),strokeWidth:l("symbolStrokeWidth")},{opacity:l("symbolOpacity")}),It.forEach((t=>{e[t]&&(b[t]=y[t]={scale:e[t],field:Pt})}));const R=sn({type:Qt,role:M,key:Pt,from:d,clip:!!u||void 0,encode:h},n.symbols),w=S(c);w.offset=l("labelOffset"),h={enter:y={opacity:Yt,x:{signal:f,offset:w},y:p},update:b={opacity:Nt,text:{field:Dt},x:y.x,y:y.y},exit:{opacity:Yt}},O(h,{align:l("labelAlign"),baseline:l("labelBaseline"),fill:l("labelColor"),fillOpacity:l("labelOpacity"),font:l("labelFont"),fontSize:l("labelFontSize"),fontStyle:l("labelFontStyle"),fontWeight:l("labelFontWeight"),limit:l("labelLimit")});const W=sn({type:Zt,role:H,style:Tt,key:Pt,from:d,encode:h},n.labels);return h={enter:{noBound:{value:!u},width:Yt,height:u?S(u):Yt,opacity:Yt},exit:{opacity:Yt},update:b={opacity:Nt,row:{signal:null},column:{signal:null}}},l.isVertical(!0)?(x=`ceil(item.mark.items.length / ${m})`,b.row.signal=`${g}%${x}`,b.column.signal=`floor(${g} / ${x})`,k={field:["row",g]}):(b.row.signal=`floor(${g} / ${m})`,b.column.signal=`${g} % ${m}`,k={field:g}),b.column.signal=`(${a})?${b.column.signal}:${g}`,en({role:_,from:i={facet:{data:i,name:"value",groupby:Ct}},encode:z(h,o,Xt),marks:[R,W],name:r,interactive:s,sort:k})}const gn='item.orient === "left"',mn='item.orient === "right"',hn=`(${gn} || ${mn})`,yn=`datum.vgrad && ${hn}`,bn=an('"top"','"bottom"','"middle"'),xn=`datum.vgrad && ${mn} ? (${an('"right"','"left"','"center"')}) : (${hn} && !(datum.vgrad && ${gn})) ? "left" : ${ln}`,kn=`item._anchor || (${hn} ? "middle" : "start")`,vn=`${yn} ? (${gn} ? -90 : 90) : 0`,$n=`${hn} ? (datum.vgrad ? (${mn} ? "bottom" : "top") : ${bn}) : "top"`;function Sn(e,t){let n;return o(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+Rn(e.path)+")":e.sphere&&(n="geoShape("+Rn(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function Rn(t){return o(t)&&t.signal?t.signal:e(t)}function On(e){const t=e.role||"";return t.startsWith("axis")||t.startsWith("legend")||t.startsWith("title")?t:e.type===Gt?_:t||W}function zn(e){return{marktype:e.type,name:e.name||void 0,role:e.role||On(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function wn(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function Wn(n,i){const a=b(n.type);a||t("Unrecognized transform type: "+e(n.type));const l=re(a.type.toLowerCase(),null,jn(a,n,i));return n.signal&&i.addSignal(n.signal,i.proxy(l)),l.metadata=a.metadata||{},l}function jn(e,t,n){const i={},a=e.params.length;for(let l=0;l<a;++l){const a=e.params[l];i[a.name]=_n(a,t,n)}return i}function _n(n,a,l){const o=n.type,s=a[n.name];return"index"===o?function(e,n,a){i(n.from)||t('Lookup "from" parameter must be a string literal.');return a.getData(n.from).lookupRef(a,n.key)}(0,a,l):void 0!==s?"param"===o?function(n,i,a){const l=i[n.name];return n.array?(r(l)||t("Expected an array of sub-parameters. Instead: "+e(l)),l.map((e=>Dn(n,e,a)))):Dn(n,l,a)}(n,a,l):"projection"===o?l.projectionRef(a[n.name]):n.array&&!be(s)?s.map((e=>Cn(n,e,l))):Cn(n,s,l):void(n.required&&t("Missing required "+e(a.type)+" parameter: "+e(n.name)))}function Cn(e,n,i){const a=e.type;if(be(n))return Pn(a)?t("Expression references can not be signals."):Tn(a)?i.fieldRef(n):Bn(a)?i.compareRef(n):i.signalRef(n.signal);{const t=e.expr||Tn(a);return t&&En(n)?i.exprRef(n.expr,n.as):t&&Fn(n)?de(n.field,n.as):Pn(a)?d(n,i):Ln(a)?ce(i.getData(n).values):Tn(a)?de(n):Bn(a)?i.compareRef(n):n}}function Dn(n,i,a){const l=n.params.length;let o;for(let e=0;e<l;++e){o=n.params[e];for(const e in o.key)if(o.key[e]!==i[e]){o=null;break}if(o)break}o||t("Unsupported parameter: "+e(i));const r=s(jn(o,i,a),o.key);return ce(a.add(Je(r)))}const En=e=>e&&e.expr,Fn=e=>e&&e.field,Ln=e=>"data"===e,Pn=e=>"expr"===e,Tn=e=>"field"===e,Bn=e=>"compare"===e;function Un(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ce(t.getData(e.data).output)}function An(e,t,n,i,a){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=a,this.index={}}function Hn(e){return i(e)?e:null}function Mn(e,t,n){const i=me(n.op,n.field);let a;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((a=n.op.signal)?e.signalRef(a):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Vn(e,t,n,i,a,l,s){const r=t[n]||(t[n]={}),u=function(e){return o(e)?(e.order===ge?"-":"+")+me(e.op,e.field):""}(l);let c,d,f=Hn(a);if(null!=f&&(e=t.scope,f+=u?"|"+u:"",c=r[f]),!c){const n=l?{field:fe,pulse:t.countsRef(e,a,l)}:{field:e.fieldRef(a),pulse:ce(t.output)};u&&(n.sort=e.sortRef(l)),d=e.add(re(i,void 0,n)),s&&(t.index[a]=d),c=ce(d),null!=f&&(r[f]=c)}return c}function qn(e,t,n){const i=e.remove,a=e.insert,l=e.toggle,o=e.modify,s=e.values,r=t.add(ue()),u="if("+e.trigger+',modify("'+n+'",'+[a,i,l,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",c=d(u,t);r.update=c.$expr,r.params=c.$params}function In(n,i){const l=On(n),o=n.type===Gt,r=n.from&&n.from.facet,u=n.overlap;let c,d,f,p,g,m,h,y=n.layout||l===_||l===j;const b=l===W||y||r,x=function(e,n,i){let l,o,r,u,c;return e?(l=e.facet)&&(n||t("Only group marks can be faceted."),null!=l.field?u=c=Un(l,i):(e.data?c=ce(i.getData(e.data).aggregate):(r=Wn(s({type:"aggregate",groupby:a(l.groupby)},l.aggregate),i),r.params.key=i.keyRef(l.groupby),r.params.pulse=Un(l,i),u=c=ce(i.add(r))),o=i.keyRef(l.groupby,!0))):u=ce(i.add(Pe(null,[{}]))),u||(u=Un(e,i)),{key:o,pulse:u,parent:c}}(n.from,o,i);d=i.add(Be({key:x.key||(n.key?de(n.key):void 0),pulse:x.pulse,clean:!o}));const k=ce(d);d=f=i.add(Pe({pulse:k})),d=i.add(Xe({markdef:zn(n),interactive:wn(n.interactive,i),clip:Sn(n.clip,i),context:{$context:!0},groups:i.lookup(),parent:i.signals.parent?i.signalRef("parent"):null,index:i.markpath(),pulse:ce(d)}));const v=ce(d);d=p=i.add(Ue(ee(n.encode,n.type,l,n.style,i,{mod:!1,pulse:v}))),d.params.parent=i.encode(),n.transform&&n.transform.forEach((e=>{const n=Wn(e,i),a=n.metadata;(a.generates||a.changes)&&t("Mark transforms should not generate new data."),a.nomod||(p.params.mod=!0),n.params.pulse=ce(d),i.add(d=n)})),n.sort&&(d=i.add(at({sort:i.compareRef(n.sort),pulse:ce(d)})));const $=ce(d);(r||y)&&(y=i.add(lt({layout:i.objectProperty(n.layout),legends:i.legends,mark:v,pulse:$})),m=ce(y));const S=i.add(Le({mark:v,pulse:m||$}));h=ce(S),o&&(b&&(c=i.operators,c.pop(),y&&c.pop()),i.pushState($,m||h,k),r?function(n,i,a){const l=n.from.facet,o=l.name,s=Un(l,i);let r;l.name||t("Facet must have a name: "+e(l)),l.data||t("Facet must reference a data set: "+e(l)),l.field?r=i.add(Ke({field:i.fieldRef(l.field),pulse:s})):l.groupby?r=i.add(He({key:i.keyRef(l.groupby),group:ce(i.proxy(a.parent)),pulse:s})):t("Facet must specify groupby or field: "+e(l));const u=i.fork(),c=u.add(Pe()),d=u.add(it({pulse:ce(c)}));u.addData(o,new An(u,c,c,d)),u.addSignal("parent",null),r.params.subflow={$subflow:u.parse(n).toRuntime()}}(n,i,x):b?function(e,t,n){const i=t.add(Ke({pulse:n.pulse})),a=t.fork();a.add(it()),a.addSignal("parent",null),i.params.subflow={$subflow:a.parse(e).toRuntime()}}(n,i,x):i.parse(n),i.popState(),b&&(y&&c.push(y),c.push(S))),u&&(h=function(e,t,n){const i=e.method,a=e.bound,l=e.separation,o={separation:be(l)?n.signalRef(l.signal):l,method:be(i)?n.signalRef(i.signal):i,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));if(a){const e=a.tolerance;o.boundTolerance=be(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(a.scale),o.boundOrient=a.orient}return ce(n.add(Ge(o)))}(u,h,i));const R=i.add(tt({pulse:h})),O=i.add(it({pulse:ce(R)},void 0,i.parent()));null!=n.name&&(g=n.name,i.addData(g,new An(i,f,R,O)),n.on&&n.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&t("Marks only support modify triggers."),qn(e,i,g)})))}function Xn(e,n){const i=n.config.legend,a=e.encode||{},l=tn(e,i),o=a.legend||{},s=o.name||void 0,r=o.interactive,u=o.style,c={};let f,p,g,m=0;It.forEach((t=>e[t]?(c[t]=e[t],m=m||e[t]):0)),m||t("Missing valid scale for legend.");const b=function(e,t){let n=e.type||Ht;e.type||1!==function(e){return It.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=h(t)?Mt:y(t)?Vt:Ht);return n!==Mt?n:y(t)?Vt:Mt}(e,n.scaleType(m)),x={title:null!=e.title,scales:c,type:b,vgrad:"symbol"!==b&&l.isVertical()},k=ce(n.add(Pe(null,[x]))),v=ce(n.add(qe(p={type:b,scale:n.scaleRef(m),count:n.objectProperty(l("tickCount")),limit:n.property(l("symbolLimit")),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)})));return b===Mt?(g=[rn(e,m,i,a.gradient),fn(e,i,a.labels,v)],p.count=p.count||n.signalRef(`max(2,2*floor((${ve(l.gradientLength())})/100))`)):b===Vt?g=[un(e,m,i,a.gradient,v),fn(e,i,a.labels,v)]:(f=function(e,t){const n=tn(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,i),g=[pn(e,i,a,v,ve(f.columns))],p.size=function(e,t,n){const i=ve(Nn("size",e,n)),a=ve(Nn("strokeWidth",e,n)),l=ve(function(e,t,n){return nn("fontSize",e)||function(e,t,n){const i=t.config.style[n];return i&&i[e]}("fontSize",t,n)}(n[1].encode,t,Tt));return d(`max(ceil(sqrt(${i})+${a}),${l})`,t)}(e,n,g[0].marks)),g=[en({role:U,from:k,encode:{enter:{x:{value:0},y:{value:0}}},marks:g,layout:f,interactive:r})],x.title&&g.push(function(e,t,n,i){const a=tn(e,t),l={enter:{opacity:Yt},update:{opacity:Nt,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Yt}};return O(l,{orient:a("titleOrient"),_anchor:a("titleAnchor"),anchor:{signal:kn},angle:{signal:vn},align:{signal:xn},baseline:{signal:$n},text:e.title,fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),baseline:a("titleBaseline")}),sn({type:Zt,role:V,style:Bt,from:i,encode:l},n)}(e,i,a.title,k)),In(en({role:T,from:k,encode:z(Yn(l,e,i),o,Xt),marks:g,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:s,interactive:r,style:u}),n)}function Yn(e,t,n){const i={enter:{},update:{}};return O(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Nn(e,t,n){return t[e]?`scale("${t[e]}",datum)`:nn(e,n[0].encode)}An.fromEntries=function(e,t){const n=t.length,i=t[n-1],a=t[n-2];let l=t[0],o=null,s=1;for(l&&"load"===l.type&&(l=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=ce(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new An(e,l,a,i,o)},An.prototype={countsRef(e,t,n){const i=this,a=i.counts||(i.counts={}),l=Hn(t);let o,s,r;return null!=l&&(e=i.scope,o=a[l]),o?n&&n.field&&Mn(e,o.agg.params,n):(r={groupby:e.fieldRef(t,"key"),pulse:ce(i.output)},n&&n.field&&Mn(e,r,n),s=e.add(Ee(r)),o=e.add(Pe({pulse:ce(s)})),o={agg:s,ref:ce(o)},null!=l&&(a[l]=o)),o.ref},tuplesRef(){return ce(this.values)},extentRef(e,t){return Vn(e,this,"extent","extent",t,!1)},domainRef(e,t){return Vn(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Vn(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Vn(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Vn(e,this,"indata","tupleindex",t,!0,!0)}};const Gn=`item.orient==="${Rt}"?-90:item.orient==="${Ot}"?90:0`;function Jn(e,t){const n=tn(e=i(e)?{text:e}:e,t.config.title),a=e.encode||{},l=a.group||{},o=l.name||void 0,r=l.interactive,u=l.style,c=[],d=ce(t.add(Pe(null,[{}])));return c.push(function(e,t,n,i){const a={value:0},l=e.text,o={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return O(o,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),sn({type:Zt,role:I,style:Ut,from:i,encode:o},n)}(e,n,function(e){const t=e.encode;return t&&t.title||s({name:e.name,interactive:e.interactive,style:e.style},t)}(e),d)),e.subtitle&&c.push(function(e,t,n,i){const a={value:0},l=e.subtitle,o={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return O(o,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),sn({type:Zt,role:X,style:At,from:i,encode:o},n)}(e,n,a.subtitle,d)),In(en({role:q,from:d,encode:Kn(n,l),marks:c,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:r,style:u}),t)}function Kn(e,t){const n={enter:{},update:{}};return O(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:ln},angle:{signal:Gn},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),z(n,t,Xt)}function Qn(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(Wn(e,t))})),e.on&&e.on.forEach((n=>{qn(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const i=[];let l,o,s,r,u,c=null,d=!1,f=!1;e.values?be(e.values)||xe(e.format)?(i.push(ei(t,e)),i.push(c=Zn())):i.push(c=Zn({$ingest:e.values,$format:e.format})):e.url?xe(e.url)||xe(e.format)?(i.push(ei(t,e)),i.push(c=Zn())):i.push(c=Zn({$request:e.url,$format:e.format})):e.source&&(c=l=a(e.source).map((e=>ce(t.getData(e).output))),i.push(null));for(o=0,s=n.length;o<s;++o)r=n[o],u=r.metadata,c||u.source||i.push(c=Zn()),i.push(r),u.generates&&(f=!0),u.modifies&&!f&&(d=!0),u.source?c=r:u.changes&&(c=null);l&&(s=l.length-1,i[0]=et({derive:d,pulse:s?l:l[0]}),(d||s)&&i.splice(1,0,Zn()));c||i.push(Zn());return i.push(it({})),i}(e,t,n))}function Zn(e){const t=Pe({},e);return t.metadata={source:!0},t}function ei(e,t){return Ie({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const ti=e=>e===zt||e===St,ni=(e,t,n)=>be(e)?ui(e.signal,t,n):e===Rt||e===St?t:n,ii=(e,t,n)=>be(e)?si(e.signal,t,n):ti(e)?t:n,ai=(e,t,n)=>be(e)?ri(e.signal,t,n):ti(e)?n:t,li=(e,t,n)=>be(e)?ci(e.signal,t,n):e===St?{value:t}:{value:n},oi=(e,t,n)=>be(e)?di(e.signal,t,n):e===Ot?{value:t}:{value:n},si=(e,t,n)=>fi(`${e} === '${St}' || ${e} === '${zt}'`,t,n),ri=(e,t,n)=>fi(`${e} !== '${St}' && ${e} !== '${zt}'`,t,n),ui=(e,t,n)=>gi(`${e} === '${Rt}' || ${e} === '${St}'`,t,n),ci=(e,t,n)=>gi(`${e} === '${St}'`,t,n),di=(e,t,n)=>gi(`${e} === '${Ot}'`,t,n),fi=(t,n,i)=>(n=null!=n?S(n):n,i=null!=i?S(i):i,pi(n)&&pi(i)?{signal:`${t} ? (${n=n?n.signal||e(n.value):null}) : (${i=i?i.signal||e(i.value):null})`}:[s({test:t},n)].concat(i||[])),pi=e=>null==e||1===Object.keys(e).length,gi=(e,t,n)=>({signal:`${e} ? (${hi(t)}) : (${hi(n)})`}),mi=(e,t,n,i,a)=>({signal:(null!=i?`${e} === '${Rt}' ? (${hi(i)}) : `:"")+(null!=n?`${e} === '${zt}' ? (${hi(n)}) : `:"")+(null!=a?`${e} === '${Ot}' ? (${hi(a)}) : `:"")+(null!=t?`${e} === '${St}' ? (${hi(t)}) : `:"")+"(null)"}),hi=t=>be(t)?t.signal:null==t?null:e(t),yi=(e,t)=>0===t?0:be(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},bi=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function xi(e,t,n,i){let a;if(t&&l(t,e))return t[e];if(l(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":a="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":a=e[5].toLowerCase()+e.slice(6)}return i[Bt][a]}if(e.startsWith("label")){switch(e){case"labelColor":a="fill";break;case"labelFont":case"labelFontSize":a=e[5].toLowerCase()+e.slice(6)}return i[Tt][a]}return null}function ki(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function vi(e,t){return{scale:e.scale,range:t}}function $i(e,t,n,i,a){const l=tn(e,t),r=e.orient,u=e.gridScale,c=ni(r,1,-1),d=function(e,t){if(1===t);else if(o(e)){let n=e=s({},e);for(;null!=n.mult;){if(!o(n.mult))return n.mult=be(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n=n.mult=s({},n.mult)}n.mult=t}else e=be(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);return e}(e.offset,c);let f,p,g;const m={enter:f={opacity:Yt},update:g={opacity:Nt},exit:p={opacity:Yt}};O(m,{stroke:l("gridColor"),strokeCap:l("gridCap"),strokeDash:l("gridDash"),strokeDashOffset:l("gridDashOffset"),strokeOpacity:l("gridOpacity"),strokeWidth:l("gridWidth")});const h={scale:e.scale,field:Pt,band:a.band,extra:a.extra,offset:a.offset,round:l("tickRound")},y=ii(r,{signal:"height"},{signal:"width"}),b=u?{scale:u,range:0,mult:c,offset:d}:{value:0,offset:d},x=u?{scale:u,range:1,mult:c,offset:d}:s(y,{mult:c,offset:d});return f.x=g.x=ii(r,h,b),f.y=g.y=ai(r,h,b),f.x2=g.x2=ai(r,x),f.y2=g.y2=ii(r,x),p.x=ii(r,h),p.y=ai(r,h),sn({type:Kt,role:E,key:Pt,from:i,encode:m},n)}function Si(e,t,n,i,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+a+")"}}function Ri(e,t,n,i){const a=tn(e,t),l=e.orient,o=ni(l,-1,1);let r,u;const c={enter:r={opacity:Yt,anchor:S(a("titleAnchor",null)),align:{signal:ln}},update:u=s({},r,{opacity:Nt,text:S(e.title)}),exit:{opacity:Yt}},d={signal:`lerp(range("${e.scale}"), ${an(0,1,.5)})`};return u.x=ii(l,d),u.y=ai(l,d),r.angle=ii(l,Yt,yi(o,90)),r.baseline=ii(l,li(l,zt,St),{value:zt}),u.angle=r.angle,u.baseline=r.baseline,O(c,{fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),angle:a("titleAngle"),baseline:a("titleBaseline")}),function(e,t,n,i){const a=(e,t)=>null!=e?(n.update[t]=bi(S(e),n.update[t]),!1):!w(t,i),l=a(e("titleX"),"x"),o=a(e("titleY"),"y");n.enter.auto=o===l?S(o):ii(t,S(o),S(l))}(a,l,c,n),c.update.align=bi(c.update.align,r.align),c.update.angle=bi(c.update.angle,r.angle),c.update.baseline=bi(c.update.baseline,r.baseline),sn({type:Zt,role:P,style:Bt,from:i,encode:c},n)}function Oi(e,t){const n=function(e,t){var n,i,a,l=t.config,o=l.style,r=l.axis,u="band"===t.scaleType(e.scale)&&l.axisBand,c=e.orient;if(be(c)){const e=ki([l.axisX,l.axisY]),t=ki([l.axisTop,l.axisBottom,l.axisLeft,l.axisRight]);for(a of(n={},e))n[a]=ii(c,xi(a,l.axisX,r,o),xi(a,l.axisY,r,o));for(a of(i={},t))i[a]=mi(c.signal,xi(a,l.axisTop,r,o),xi(a,l.axisBottom,r,o),xi(a,l.axisLeft,r,o),xi(a,l.axisRight,r,o))}else n=c===St||c===zt?l.axisX:l.axisY,i=l["axis"+c[0].toUpperCase()+c.slice(1)];return n||i||u?s({},r,n,i,u):r}(e,t),i=e.encode||{},a=i.axis||{},l=a.name||void 0,r=a.interactive,u=a.style,c=tn(e,n),d=function(e){const t=e("tickBand");let n,i,a=e("tickOffset");return t?t.signal?(n={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${t.signal}) === 'extent'`},o(a)||(a={signal:`(${t.signal}) === 'extent' ? 0 : ${a}`})):"extent"===t?(n=1,i=!0,a=0):(n=.5,i=!1):(n=e("bandPosition"),i=e("tickExtra")),{extra:i,band:n,offset:a}}(c),f={scale:e.scale,ticks:!!c("ticks"),labels:!!c("labels"),grid:!!c("grid"),domain:!!c("domain"),title:null!=e.title},p=ce(t.add(Pe({},[f]))),g=ce(t.add(Fe({scale:t.scaleRef(e.scale),extra:t.property(d.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),m=[];let h;return f.grid&&m.push($i(e,n,i.grid,g,d)),f.ticks&&(h=c("tickSize"),m.push(function(e,t,n,i,a,l){const o=tn(e,t),s=e.orient,r=ni(s,-1,1);let u,c,d;const f={enter:u={opacity:Yt},update:d={opacity:Nt},exit:c={opacity:Yt}};O(f,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const p=S(a);p.mult=r;const g={scale:e.scale,field:Pt,band:l.band,extra:l.extra,offset:l.offset,round:o("tickRound")};return d.y=u.y=ii(s,Yt,g),d.y2=u.y2=ii(s,p),c.x=ii(s,g),d.x=u.x=ai(s,Yt,g),d.x2=u.x2=ai(s,p),c.y=ai(s,g),sn({type:Kt,role:L,key:Pt,from:i,encode:f},n)}(e,n,i.ticks,g,h,d))),f.labels&&(h=f.ticks?h:0,m.push(function(e,t,n,i,a,l){const o=tn(e,t),s=e.orient,r=e.scale,u=ni(s,-1,1),c=ve(o("labelFlush")),d=ve(o("labelFlushOffset")),f=o("labelAlign"),p=o("labelBaseline");let g,m=0===c||!!c;const h=S(a);h.mult=u,h.offset=S(o("labelPadding")||0),h.offset.mult=u;const y={scale:r,field:Pt,band:.5,offset:on(l.offset,o("labelOffset"))},b=ii(s,m?Si(r,c,'"left"','"right"','"center"'):{value:"center"},oi(s,"left","right")),x=ii(s,li(s,"bottom","top"),m?Si(r,c,'"top"','"bottom"','"middle"'):{value:"middle"}),k=Si(r,c,`-(${d})`,d,0);m=m&&d;const v={opacity:Yt,x:ii(s,y,h),y:ai(s,y,h)},$={enter:v,update:g={opacity:Nt,text:{field:Dt},x:v.x,y:v.y,align:b,baseline:x},exit:{opacity:Yt,x:v.x,y:v.y}};O($,{dx:!f&&m?ii(s,k):null,dy:!p&&m?ai(s,k):null}),O($,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:f,baseline:p});const R=o("labelBound");let z=o("labelOverlap");return z=z||R?{separation:o("labelSeparation"),method:z,order:"datum.index",bound:R?{scale:r,orient:s,tolerance:R}:null}:void 0,g.align!==b&&(g.align=bi(g.align,b)),g.baseline!==x&&(g.baseline=bi(g.baseline,x)),sn({type:Zt,role:F,style:Tt,key:Pt,from:i,encode:$,overlap:z},n)}(e,n,i.labels,g,h,d))),f.domain&&m.push(function(e,t,n,i){const a=tn(e,t),l=e.orient;let o,s;const r={enter:o={opacity:Yt},update:s={opacity:Nt},exit:{opacity:Yt}};O(r,{stroke:a("domainColor"),strokeCap:a("domainCap"),strokeDash:a("domainDash"),strokeDashOffset:a("domainDashOffset"),strokeWidth:a("domainWidth"),strokeOpacity:a("domainOpacity")});const u=vi(e,0),c=vi(e,1);return o.x=s.x=ii(l,u,Yt),o.x2=s.x2=ii(l,c),o.y=s.y=ai(l,u,Yt),o.y2=s.y2=ai(l,c),sn({type:Kt,role:D,from:i,encode:r},n)}(e,n,i.domain,p)),f.title&&m.push(Ri(e,n,i.title,p)),In(en({role:C,from:p,encode:z(zi(c,e),a,Xt),marks:m,aria:c("aria"),description:c("description"),zindex:c("zindex"),name:l,interactive:r,style:u}),t)}function zi(e,t){const n={enter:{},update:{}};return O(n,{orient:e("orient"),offset:e("offset")||0,position:ke(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function wi(n,i,l){const o=a(n.signals),s=a(n.scales);return l||o.forEach((e=>oe(e,i))),a(n.projections).forEach((e=>function(e,t){const n=t.config.projection||{},i={};for(const n in e)"name"!==n&&(i[n]=$t(e[n],n,t));for(const e in n)null==i[e]&&(i[e]=$t(n[e],e,t));t.addProjection(e.name,i)}(e,i))),s.forEach((n=>function(n,i){const a=n.type||"linear";p(a)||t("Unrecognized scale type: "+e(a)),i.addScale(n.name,{type:a,domain:void 0})}(n,i))),a(n.data).forEach((e=>Qn(e,i))),s.forEach((e=>ut(e,i))),(l||o).forEach((e=>Ce(e,i))),a(n.axes).forEach((e=>Oi(e,i))),a(n.marks).forEach((e=>In(e,i))),a(n.legends).forEach((e=>Xn(e,i))),n.title&&Jn(n.title,i),i.parseLambdas(),i}const Wi=e=>z({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function ji(e,t){const n=t.config,i=ce(t.root=t.add(ue())),o=function(e,t){const n=n=>ke(e[n],t[n]),i=[_i("background",n("background")),_i("autosize",x(n("autosize"))),_i("padding",$(n("padding"))),_i("width",n("width")||0),_i("height",n("height")||0)],o=i.reduce(((e,t)=>(e[t.name]=t,e)),{}),r={};return a(e.signals).forEach((e=>{l(o,e.name)?e=s(o[e.name],e):i.push(e),r[e.name]=e})),a(t.signals).forEach((e=>{l(r,e.name)||l(o,e.name)||i.push(e)})),i}(e,n);o.forEach((e=>oe(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const r=t.add(Pe()),u=t.add(Ue(ee(Wi(e.encode),Gt,j,e.style,t,{pulse:ce(r)}))),c=t.add(lt({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:ce(u)}));t.operators.pop(),t.pushState(ce(u),ce(c),null),wi(e,t,o),t.operators.push(c);let d=t.add(Le({mark:i,pulse:ce(c)}));return d=t.add(tt({pulse:ce(d)})),d=t.add(it({pulse:ce(d)})),t.addData("root",new An(t,r,r,d)),t}function _i(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Ci(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Di(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function Ei(e){return(r(e)?Fi:Li)(e)}function Fi(t){const n=t.length;let i="[";for(let a=0;a<n;++a){const n=t[a];i+=(a>0?",":"")+(o(n)?n.signal||Ei(n):e(n))}return i+"]"}function Li(t){let n,i,a="{",l=0;for(n in t)i=t[n],a+=(++l>1?",":"")+e(n)+":"+(o(i)?i.signal||Ei(i):e(i));return a+"}"}function Pi(){const e="sans-serif",t="#4c78a8",n="#000",i="#888",a="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:a},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:i,grid:!1,gridWidth:1,gridColor:a,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:i,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:a,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:i,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Ti(e,n,i){return o(e)||t("Input Vega specification must be an object."),ji(e,new Ci(n=u(Pi(),n,e.config),i)).toRuntime()}Ci.prototype=Di.prototype={parse(e){return wi(e,this)},fork(){return new Di(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof se?ce(e):e;return this.add(Ze({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let i,a;e&&(i=e.data||(e.data={}),a=i[t]||(i[t]=[]),a.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(ce(this.add(it({pulse:e})))),this._parent.push(t),this._lookup.push(n?ce(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return n(this._parent)},encode(){return n(this._encode)},lookup(){return n(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(n,a){if(i(n))return de(n,a);n.signal||t("Unsupported field reference: "+e(n));const l=n.signal;let o=this.field[l];if(!o){const e={name:this.signalRef(l)};a&&(e.as=a),this.field[l]=o=ce(this.add(Me(e)))}return o},compareRef(e){let t=!1;const n=e=>be(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,i=a(e.field).map(n),l=a(e.order).map(n);return t?ce(this.add(Te({fields:i,orders:l}))):pe(i,l)},keyRef(e,t){let n=!1;const i=this.signals;return e=a(e).map((e=>be(e)?(n=!0,ce(i[e.signal])):e)),n?ce(this.add(Ve({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=me(e.op,e.field),n=e.order||"ascending";return n.signal?ce(this.add(Te({fields:t,orders:this.signalRef(n.signal)}))):pe(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return l(this.signals,e)},addSignal(n,i){this.hasOwnSignal(n)&&t("Duplicate signal name: "+e(n));const a=i instanceof se?i:this.add(ue(i));return this.signals[n]=a},getSignal(n){return this.signals[n]||t("Unrecognized signal name: "+e(n)),this.signals[n]},signalRef(e){return this.signals[e]?ce(this.signals[e]):(l(this.lambdas,e)||(this.lambdas[e]=this.add(ue(null))),ce(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],i=d(n,this),a=this.lambdas[n];a.params=i.$params,a.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&o(e)?this.signalRef(e.signal||Ei(e)):e},exprRef(e,t){const n={expr:d(e,this)};return t&&(n.expr.$name=t),ce(this.add(Ae(n)))},addBinding(n,i){this.bindings||t("Nested signals do not support binding: "+e(n)),this.bindings.push(s({signal:n},i))},addScaleProj(n,i){l(this.scales,n)&&t("Duplicate scale or projection name: "+e(n)),this.scales[n]=this.add(i)},addScale(e,t){this.addScaleProj(e,nt(t))},addProjection(e,t){this.addScaleProj(e,Qe(t))},getScale(n){return this.scales[n]||t("Unrecognized scale name: "+e(n)),this.scales[n]},scaleRef(e){return ce(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(n,i){return l(this.data,n)&&t("Duplicate data set name: "+e(n)),this.data[n]=i},getData(n){return this.data[n]||t("Undefined data set name: "+e(n)),this.data[n]},addDataPipeline(n,i){return l(this.data,n)&&t("Duplicate data set name: "+e(n)),this.addData(n,An.fromEntries(this,i))}};export{D as AxisDomainRole,E as AxisGridRole,F as AxisLabelRole,C as AxisRole,L as AxisTickRole,P as AxisTitleRole,An as DataScope,j as FrameRole,U as LegendEntryRole,H as LegendLabelRole,T as LegendRole,M as LegendSymbolRole,V as LegendTitleRole,W as MarkRole,Ci as Scope,_ as ScopeRole,Pi as config,Ti as parse,oe as signal,Ce as signalUpdates,Se as stream};export default null;
