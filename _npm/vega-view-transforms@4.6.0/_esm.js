/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/vega-view-transforms@4.6.0/build/vega-view-transforms.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Transform as t}from"../vega-dataflow@5.7.6/_esm.js";import{Marks as e,boundClip as n,GroupItem as o,Item as a,Bounds as r,multiLineOffset as i,boundStroke as s}from"../vega-scenegraph@4.13.0/_esm.js";import{inherits as c,peek as u,isObject as l}from"../vega-util@1.17.2/_esm.js";const d="top",h="left",f="right",m="bottom",y="top-left",b="top-right",x="bottom-left",g="bottom-right",p="start",w="middle",k="end",M="x",v="y",E="group",z="axis",A="title",_="frame",D="scope",B="legend",O="row-header",T="row-footer",S="row-title",j="column-header",q="column-footer",F="column-title",H="padding",L="symbol",P="fit",R="fit-x",C="fit-y",G="pad",I="none",U="all",V="each",W="flush",J="column",K="row";function N(e){t.call(this,null,e)}function Q(t,e,n){return e(t.bounds.clear(),t,n)}c(N,t,{transform(t,o){const a=o.dataflow,r=t.mark,i=r.marktype,s=e[i],c=s.bound;let u,l=r.bounds;if(s.nested)r.items.length&&a.dirty(r.items[0]),l=Q(r,c),r.items.forEach((t=>{t.bounds.clear().union(l)}));else if(i===E||t.modified())switch(o.visit(o.MOD,(t=>a.dirty(t))),l.clear(),r.items.forEach((t=>l.union(Q(t,c)))),r.role){case z:case B:case A:o.reflow()}else u=o.changed(o.REM),o.visit(o.ADD,(t=>{l.union(Q(t,c))})),o.visit(o.MOD,(t=>{u=u||l.alignsWith(t.bounds),a.dirty(t),l.union(Q(t,c))})),u&&(l.clear(),r.items.forEach((t=>l.union(t.bounds))));return n(r),o.modifies("bounds")}});const X=":vega_identifier:";function Y(e){t.call(this,0,e)}function Z(e){t.call(this,null,e)}function $(e){t.call(this,null,e)}Y.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},c(Y,t,{transform(t,e){const n=(a=e.dataflow)._signals[X]||(a._signals[X]=a.add(0)),o=t.as;var a;let r=n.value;return e.visit(e.ADD,(t=>t[o]=t[o]||++r)),n.set(this.value=r),e}}),c(Z,t,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const r=n.marktype===E?o:a;return e.visit(e.ADD,(t=>r.call(t,n))),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});const tt={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,o)=>o&&et(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1)))}},et=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),nt=(t,e)=>{for(var n,o=1,a=t.length,r=t[0].bounds;o<a;r=n,++o)if(et(r,n=t[o].bounds,e))return!0},ot=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},at=t=>(t.forEach((t=>t.opacity=1)),t),rt=(t,e)=>t.reflow(e.modified()).modifies("opacity");function it(e){t.call(this,null,e)}c($,t,{transform(t,e){const n=tt[t.method]||tt.parity,o=t.separation||0;let a,i,s=e.materialize(e.SOURCE).source;if(!s||!s.length)return;if(!t.method)return t.modified("method")&&(at(s),e=rt(e,t)),e;if(s=s.filter(ot),!s.length)return;if(t.sort&&(s=s.slice().sort(t.sort)),a=at(s),e=rt(e,t),a.length>=3&&nt(a,o)){do{a=n(a,o)}while(a.length>=3&&nt(a,o));a.length<3&&!u(s).opacity&&(a.length>1&&(u(a).opacity=0),u(s).opacity=1)}var c,l,h,f,y;t.boundScale&&t.boundTolerance>=0&&(c=t.boundScale,l=t.boundOrient,h=+t.boundTolerance,f=c.range(),y=new r,l===d||l===m?y.set(f[0],-1/0,f[1],1/0):y.set(-1/0,f[0],1/0,f[1]),y.expand(h||1),i=t=>y.encloses(t.bounds),s.forEach((t=>{i(t)||(t.opacity=0)})));const b=a[0].mark.bounds.clear();return s.forEach((t=>{t.opacity&&b.union(t.bounds)})),e}}),c(it,t,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,(t=>n.dirty(t))),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const st=new r;function ct(t,e,n){return t[e]===n?0:(t[e]=n,1)}function ut(t){var e=t.items[0].orient;return e===h||e===f}function lt(t,e,n,o){var a,r,c=e.items[0],u=c.datum,l=null!=c.translate?c.translate:.5,y=c.orient,b=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(u),x=c.range,g=c.offset,p=c.position,w=c.minExtent,k=c.maxExtent,M=u.title&&c.items[b[2]].items[0],v=c.titlePadding,E=c.bounds,z=M&&i(M),A=0,_=0;switch(st.clear().union(E),E.clear(),(a=b[0])>-1&&E.union(c.items[a].bounds),(a=b[1])>-1&&E.union(c.items[a].bounds),y){case d:A=p||0,_=-g,r=Math.max(w,Math.min(k,-E.y1)),E.add(0,-r).add(x,0),M&&dt(t,M,r,v,z,0,-1,E);break;case h:A=-g,_=p||0,r=Math.max(w,Math.min(k,-E.x1)),E.add(-r,0).add(0,x),M&&dt(t,M,r,v,z,1,-1,E);break;case f:A=n+g,_=p||0,r=Math.max(w,Math.min(k,E.x2)),E.add(0,0).add(r,x),M&&dt(t,M,r,v,z,1,1,E);break;case m:A=p||0,_=o+g,r=Math.max(w,Math.min(k,E.y2)),E.add(0,0).add(x,r),M&&dt(t,M,r,v,0,0,1,E);break;default:A=c.x,_=c.y}return s(E.translate(A,_),c),ct(c,"x",A+l)|ct(c,"y",_+l)&&(c.bounds=st,t.dirty(c),c.bounds=E,t.dirty(c)),c.mark.bounds.clear().union(E)}function dt(t,e,n,o,a,r,i,s){const c=e.bounds;if(e.auto){const s=i*(n+a+o);let u=0,l=0;t.dirty(e),r?u=(e.x||0)-(e.x=s):l=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(c.translate(-u,-l)),t.dirty(e)}s.union(c)}const ht=(t,e)=>Math.floor(Math.min(t,e)),ft=(t,e)=>Math.ceil(Math.max(t,e));function mt(t){return(new r).set(0,0,t.width||0,t.height||0)}function yt(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function bt(t,e,n){const o=l(t)?t[e]:t;return null!=o?o:void 0!==n?n:0}function xt(t){return t<0?Math.ceil(-t):0}function gt(t,e,n){var o,a,r,i,s,c,u,l,d,h,f,m=!n.nodirty,y=n.bounds===W?mt:yt,b=st.set(0,0,0,0),x=bt(n.align,J),g=bt(n.align,K),p=bt(n.padding,J),E=bt(n.padding,K),z=n.columns||e.length,A=z<=0?1:Math.ceil(e.length/z),_=e.length,D=Array(_),B=Array(z),O=0,T=Array(_),S=Array(A),j=0,q=Array(_),F=Array(_),H=Array(_);for(a=0;a<z;++a)B[a]=0;for(a=0;a<A;++a)S[a]=0;for(a=0;a<_;++a)c=e[a],s=H[a]=y(c),c.x=c.x||0,q[a]=0,c.y=c.y||0,F[a]=0,r=a%z,i=~~(a/z),O=Math.max(O,u=Math.ceil(s.x2)),j=Math.max(j,l=Math.ceil(s.y2)),B[r]=Math.max(B[r],u),S[i]=Math.max(S[i],l),D[a]=p+xt(s.x1),T[a]=E+xt(s.y1),m&&t.dirty(e[a]);for(a=0;a<_;++a)a%z==0&&(D[a]=0),a<z&&(T[a]=0);if(x===V)for(r=1;r<z;++r){for(f=0,a=r;a<_;a+=z)f<D[a]&&(f=D[a]);for(a=r;a<_;a+=z)D[a]=f+B[r-1]}else if(x===U){for(f=0,a=0;a<_;++a)a%z&&f<D[a]&&(f=D[a]);for(a=0;a<_;++a)a%z&&(D[a]=f+O)}else for(x=!1,r=1;r<z;++r)for(a=r;a<_;a+=z)D[a]+=B[r-1];if(g===V)for(i=1;i<A;++i){for(f=0,o=(a=i*z)+z;a<o;++a)f<T[a]&&(f=T[a]);for(a=i*z;a<o;++a)T[a]=f+S[i-1]}else if(g===U){for(f=0,a=z;a<_;++a)f<T[a]&&(f=T[a]);for(a=z;a<_;++a)T[a]=f+j}else for(g=!1,i=1;i<A;++i)for(o=(a=i*z)+z;a<o;++a)T[a]+=S[i-1];for(d=0,a=0;a<_;++a)d=D[a]+(a%z?d:0),q[a]+=d-e[a].x;for(r=0;r<z;++r)for(h=0,a=r;a<_;a+=z)h+=T[a],F[a]+=h-e[a].y;if(x&&bt(n.center,J)&&A>1)for(a=0;a<_;++a)(d=(s=x===U?O:B[a%z])-H[a].x2-e[a].x-q[a])>0&&(q[a]+=d/2);if(g&&bt(n.center,K)&&1!==z)for(a=0;a<_;++a)(h=(s=g===U?j:S[~~(a/z)])-H[a].y2-e[a].y-F[a])>0&&(F[a]+=h/2);for(a=0;a<_;++a)b.union(H[a].translate(q[a],F[a]));switch(d=bt(n.anchor,M),h=bt(n.anchor,v),bt(n.anchor,J)){case k:d-=b.width();break;case w:d-=b.width()/2}switch(bt(n.anchor,K)){case k:h-=b.height();break;case w:h-=b.height()/2}for(d=Math.round(d),h=Math.round(h),b.clear(),a=0;a<_;++a)e[a].mark.bounds.clear();for(a=0;a<_;++a)(c=e[a]).x+=q[a]+=d,c.y+=F[a]+=h,b.union(c.mark.bounds.union(c.bounds.translate(q[a],F[a]))),m&&t.dirty(c);return b}function pt(t,e,n){var o,a,r,i,s,c,u,l=function(t){var e,n,o=t.items,a=o.length,r=0;const i={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<a;++r)if(n=(e=o[r]).items,e.marktype===E)switch(e.role){case z:case B:case A:break;case O:i.rowheaders.push(...n);break;case T:i.rowfooters.push(...n);break;case j:i.colheaders.push(...n);break;case q:i.colfooters.push(...n);break;case S:i.rowtitle=n[0];break;case F:i.coltitle=n[0];break;default:i.marks.push(...n)}return i}(e),d=l.marks,h=n.bounds===W?wt:kt,f=n.offset,m=n.columns||d.length,y=m<=0?1:Math.ceil(d.length/m),b=y*m;const x=gt(t,d,n);x.empty()&&x.set(0,0,0,0),l.rowheaders&&(c=bt(n.headerBand,K,null),o=Mt(t,l.rowheaders,d,m,y,-bt(f,"rowHeader"),ht,0,h,"x1",0,m,1,c)),l.colheaders&&(c=bt(n.headerBand,J,null),a=Mt(t,l.colheaders,d,m,m,-bt(f,"columnHeader"),ht,1,h,"y1",0,1,m,c)),l.rowfooters&&(c=bt(n.footerBand,K,null),r=Mt(t,l.rowfooters,d,m,y,bt(f,"rowFooter"),ft,0,h,"x2",m-1,m,1,c)),l.colfooters&&(c=bt(n.footerBand,J,null),i=Mt(t,l.colfooters,d,m,m,bt(f,"columnFooter"),ft,1,h,"y2",b-m,1,m,c)),l.rowtitle&&(s=bt(n.titleAnchor,K),u=bt(f,"rowTitle"),u=s===k?r+u:o-u,c=bt(n.titleBand,K,.5),vt(t,l.rowtitle,u,0,x,c)),l.coltitle&&(s=bt(n.titleAnchor,J),u=bt(f,"columnTitle"),u=s===k?i+u:a-u,c=bt(n.titleBand,J,.5),vt(t,l.coltitle,u,1,x,c))}function wt(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function kt(t,e){return t.bounds[e]}function Mt(t,e,n,o,a,r,i,s,c,u,l,d,h,f){var m,y,b,x,g,p,w,k,M,v=n.length,E=0,z=0;if(!v)return E;for(m=l;m<v;m+=d)n[m]&&(E=i(E,c(n[m],u)));if(!e.length)return E;for(e.length>a&&(t.warn("Grid headers exceed limit: "+a),e=e.slice(0,a)),E+=r,y=0,x=e.length;y<x;++y)t.dirty(e[y]),e[y].mark.bounds.clear();for(m=l,y=0,x=e.length;y<x;++y,m+=d){for(g=(p=e[y]).mark.bounds,b=m;b>=0&&null==(w=n[b]);b-=h);s?(k=null==f?w.x:Math.round(w.bounds.x1+f*w.bounds.width()),M=E):(k=E,M=null==f?w.y:Math.round(w.bounds.y1+f*w.bounds.height())),g.union(p.bounds.translate(k-(p.x||0),M-(p.y||0))),p.x=k,p.y=M,t.dirty(p),z=i(z,g[u])}return z}function vt(t,e,n,o,a,r){if(e){t.dirty(e);var i=n,s=n;o?i=Math.round(a.x1+r*a.width()):s=Math.round(a.y1+r*a.height()),e.bounds.translate(i-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=i,e.y=s,t.dirty(e)}}function Et(t,e,n,o,a,r,i){const s=function(t,e){const n=t[e]||{};return(e,o)=>null!=n[e]?n[e]:null!=t[e]?t[e]:o}(n,e),c=function(t,e){let n=-1/0;return t.forEach((t=>{null!=t.offset&&(n=Math.max(n,t.offset))})),n>-1/0?n:e}(t,s("offset",0)),u=s("anchor",p),l=u===k?1:u===w?.5:0,M={align:V,bounds:s("bounds",W),columns:"vertical"===s("direction")?1:t.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(e){case h:M.anchor={x:Math.floor(o.x1)-c,column:k,y:l*(i||o.height()+2*o.y1),row:u};break;case f:M.anchor={x:Math.ceil(o.x2)+c,y:l*(i||o.height()+2*o.y1),row:u};break;case d:M.anchor={y:Math.floor(a.y1)-c,row:k,x:l*(r||a.width()+2*a.x1),column:u};break;case m:M.anchor={y:Math.ceil(a.y2)+c,x:l*(r||a.width()+2*a.x1),column:u};break;case y:M.anchor={x:c,y:c};break;case b:M.anchor={x:r-c,y:c,column:k};break;case x:M.anchor={x:c,y:i-c,row:k};break;case g:M.anchor={x:r-c,y:i-c,column:k,row:k}}return M}function zt(t,e){var n,o,a=e.items[0],r=a.datum,i=a.orient,c=a.bounds,u=a.x,l=a.y;return a._bounds?a._bounds.clear().union(c):a._bounds=c.clone(),c.clear(),function(t,e,n){var o=e.padding,a=o-n.x,r=o-n.y;if(e.datum.title){var i=e.items[1].items[0],s=i.anchor,c=e.titlePadding||0,u=o-i.x,l=o-i.y;switch(i.orient){case h:a+=Math.ceil(i.bounds.width())+c;break;case f:case m:break;default:r+=i.bounds.height()+c}switch((a||r)&&_t(t,n,a,r),i.orient){case h:l+=At(e,n,i,s,1,1);break;case f:u+=At(e,n,i,k,0,0)+c,l+=At(e,n,i,s,1,1);break;case m:u+=At(e,n,i,s,0,0),l+=At(e,n,i,k,-1,0,1)+c;break;default:u+=At(e,n,i,s,0,0)}(u||l)&&_t(t,i,u,l),(u=Math.round(i.bounds.x1-o))<0&&(_t(t,n,-u,0),_t(t,i,-u,0))}else(a||r)&&_t(t,n,a,r)}(t,a,a.items[0].items[0]),c=function(t,e){return t.items.forEach((t=>e.union(t.bounds))),e.x1=t.padding,e.y1=t.padding,e}(a,c),n=2*a.padding,o=2*a.padding,c.empty()||(n=Math.ceil(c.width()+n),o=Math.ceil(c.height()+o)),r.type===L&&function(t){const e=t.reduce(((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t)),{});t.forEach((t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y}))}(a.items[0].items[0].items[0].items),i!==I&&(a.x=u=0,a.y=l=0),a.width=n,a.height=o,s(c.set(u,l,u+n,l+o),a),a.mark.bounds.clear().union(c),a}function At(t,e,n,o,a,r,s){const c="symbol"!==t.datum.type,u=n.datum.vgrad,l=(!c||!r&&u||s?e:e.items[0]).bounds[a?"y2":"x2"]-t.padding,d=u&&r?l:0,h=u&&r?0:l,f=a<=0?0:i(n);return Math.round(o===p?d:o===k?h-f:.5*(l-f))}function _t(t,e,n,o){e.x+=n,e.y+=o,e.bounds.translate(n,o),e.mark.bounds.translate(n,o),t.dirty(e)}function Dt(e){t.call(this,null,e)}c(Dt,t,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach((e=>{t.layout&&pt(n,e,t.layout),function(t,e,n){var o,a,i,s,c,u=e.items,l=Math.max(0,e.width||0),y=Math.max(0,e.height||0),b=(new r).set(0,0,l,y),x=b.clone(),g=b.clone(),w=[];for(s=0,c=u.length;s<c;++s)switch((a=u[s]).role){case z:(ut(a)?x:g).union(lt(t,a,l,y));break;case A:o=a;break;case B:w.push(zt(t,a));break;case _:case D:case O:case T:case S:case j:case q:case F:x.union(a.bounds),g.union(a.bounds);break;default:b.union(a.bounds)}if(w.length){const e={};w.forEach((t=>{(i=t.orient||f)!==I&&(e[i]||(e[i]=[])).push(t)}));for(const o in e){const a=e[o];gt(t,a,Et(a,o,n.legends,x,g,l,y))}w.forEach((e=>{const o=e.bounds;if(o.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=o,t.dirty(e)),!n.autosize||n.autosize.type!==P&&n.autosize.type!==R&&n.autosize.type!==C)b.union(o);else switch(e.orient){case h:case f:b.add(o.x1,0).add(o.x2,0);break;case d:case m:b.add(0,o.y1).add(0,o.y2)}}))}b.union(x).union(g),o&&b.union(function(t,e,n,o,a){var r,i=e.items[0],s=i.frame,c=i.orient,u=i.anchor,l=i.offset,y=i.padding,b=i.items[0].items[0],x=i.items[1]&&i.items[1].items[0],g=c===h||c===f?o:n,w=0,M=0,v=0,z=0,A=0;if(s!==E?c===h?(w=a.y2,g=a.y1):c===f?(w=a.y1,g=a.y2):(w=a.x1,g=a.x2):c===h&&(w=o,g=0),r=u===p?w:u===k?g:(w+g)/2,x&&x.text){switch(c){case d:case m:A=b.bounds.height()+y;break;case h:z=b.bounds.width()+y;break;case f:z=-b.bounds.width()-y}st.clear().union(x.bounds),st.translate(z-(x.x||0),A-(x.y||0)),ct(x,"x",z)|ct(x,"y",A)&&(t.dirty(x),x.bounds.clear().union(st),x.mark.bounds.clear().union(st),t.dirty(x)),st.clear().union(x.bounds)}else st.clear();switch(st.union(b.bounds),c){case d:M=r,v=a.y1-st.height()-l;break;case h:M=a.x1-st.width()-l,v=r;break;case f:M=a.x2+st.width()+l,v=r;break;case m:M=r,v=a.y2+l;break;default:M=i.x,v=i.y}return ct(i,"x",M)|ct(i,"y",v)&&(st.translate(M,v),t.dirty(i),i.bounds.clear().union(st),e.bounds.clear().union(st),t.dirty(i)),i.bounds}(t,o,l,y,b));e.clip&&b.set(0,0,e.width||0,e.height||0);!function(t,e,n,o){const a=o.autosize||{},r=a.type;if(t._autosize<1||!r)return;let i=t._width,s=t._height,c=Math.max(0,e.width||0),u=Math.max(0,Math.ceil(-n.x1)),l=Math.max(0,e.height||0),d=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-c)),f=Math.max(0,Math.ceil(n.y2-l));if(a.contains===H){const e=t.padding();i-=e.left+e.right,s-=e.top+e.bottom}r===I?(u=0,d=0,c=i,l=s):r===P?(c=Math.max(0,i-u-h),l=Math.max(0,s-d-f)):r===R?(c=Math.max(0,i-u-h),s=l+d+f):r===C?(i=c+u+h,l=Math.max(0,s-d-f)):r===G&&(i=c+u+h,s=l+d+f);t._resizeView(i,s,c,l,[u,d],a.resize)}(t,e,b,n)}(n,e,t)})),(o=t.mark.group)&&"legend-entry"!==o.mark.role?e.reflow():e;var o}});export{N as bound,Y as identifier,Z as mark,$ as overlap,it as render,Dt as viewlayout};export default null;
